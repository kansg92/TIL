# LDAP



## LDAP이란?

- Lightweight Directory Access Protocol
- 사용자가 조직, 구성원에 대한 데이터를 찾는데 도움이 되는 프로토콜을 말한다.
- 네트워크 상의 디렉토리 서비스 표준인 X.500의 DAP(Directory Access Protocol)을 기반으로 경량화된 DAP버전이다.
  - DAP은 OSI 전체 프로토콜 스택을 지원하며 운영에 매우 많은 컴퓨팅 자원을 필요로하는 무거운 프로토콜
  - LDAP은 DAP의 복잡성을 줄이고 TCP/IP 레이어에서 더 적은 비용으로 DAP의 많은 기능적인 부분을 조작 할 수 있도록 설계
- Directory Service 
  - 이름을 기준으로 대상을 찾아 조회하거 편집할 수 있는 서비스
  - DNS(Domain Name Service)도 디렉토리 서비스의 일종이다.
    - DNS는 도메인 이름으로 IP 주소를 조회

- How to LightWeight
  - 사용하기 간편하다는 의미가 아닌 통신 네트워크 대역폭 상의 가벼움을 의미
  - 인터넷 프로토콜로 데이터를 조금만 주고 받아도 되게끔 설계되었음.
  - LDAP의 요청의 99%는 검색에 대한 요청
  - 디렉토리 안에는 연락처, 사용자, 파일, code 등 무엇이든 넣을 수 있고, insert, update 보다는 검색 요청에 특화
  - 검색에 특화되다보니 트랙잭션이나 롤백이 없고 복잡한 관계를 설정할 수 없다.
  - 신뢰성이나 가용성을 개선하기 위해 쉽게 복제될 수 있는 아키텍처로 이루어져 있다.

- 바이너리 프로토콜이다.
  - ASN.1 이라는 언어로 메시지를 표현
  - 메시지를 BER(Basic Encoding Rules)라는 포멧으로 인코딩하여 주고 받음.
    - BER 인코딩이 바이너리라서 내용을 알아 볼 수 없다.

- 비동기 프로토콜이다.
  - 세션을 하나만 열어서 여러 메시지 요청을 보낼 수 있고, 가각의 요청에 대한 응답이 다른 시점에 올 수 있음.
  - 응답마다 어떤 요청의 응답인지 식별할 수 있는 아디가 부여됨.




## 용도

- 사용자, 시스템 , 네트워크, 서비스, 애플리케이션 등의 정보를 트리구조로 저장하여 조회하거나 관리
- 회사에서 구겅원의 조직도나 팀별 이메일 주소 등도  LDAP 서비스로 관리
  - 특정 영역에서 이용자명과 패스워드를 확인하여 인증하는 용도로 쓰임.
- 인증이든 무엇이든 트리 구조로 검색하고 편집하기 좋은 데티터들은 LDAP을 많이 사용
- LDAP은 서버에만 적용되는 프로토콜이 아니라 주소록 관리에 사용되거나 스마트폰 내에서도 LDAP 클라이언트카 포함되어있음.
  - 안드로이드 스마트폰은 조금 복잡한 과정이 필요해보임......
- 특정 데이터를 중앙에서 일괄 관리하는 일반적이 경우에 사용
  - 유저 권한 관리, 주소록, 조직도, 사용자 정보 관리, 어플리케이션 / 시스템 설정 정보, 공개 키 인프라스트럭처, DHCP나 DNS등의 저장소, 문서 관리, 이미지 저장소 , Code 등...



## 주요용어

- **DN (Distiguish Name)** : LDAP에서 탐색할 디렉토리 정보 트리(DIT)를 통한 결로가 포함된 고유 이름
  - 예 : cn = Kan, ou=users, o=Company
- **RDN (Relative Distinguished Name) :** DN내 경로의 각 구성요소
  - 예 : cn = Kan
- **DIT : Directory Information Tree**
- **LDIF : LDAP Data Interchange Format**
- **UID : User ID**
- **DC : Domain Component**
- **OU : Organizational Unit**
- **DSA(Directory System Agent)** : 네트워크에서 LDAP를 실행하는 서버
- **DUA(Directory User Agent) :** DSA에 클라이언트(예: 사용자의 PC)로 액세스
- **API(Application Programming Interface)** : API를 사용하면 다른 제품 / 서비스의 구현 방식을 몰라도 보유한 제품 / 서비스와 다른 제품 / 서비스가 서로 통신 할 수 있다.



## LDAP 프로세스

사용자가 PC에서 비지니스 이메일 애플리케이션과 같은 LDAP 지원 클라이언트 프로그램에 액세스를 시도할 때 이 프로세스가 시작된다.

LDAPv3에서는 두 가지 사용 가능한 사용자 인증 방법, 즉 로그인 자격 증명이 있는 SSO와 같은 단순 인증 또는 Kerberos와 같은 프로그램에 LDAP 서버를 바인딩 하는 SASL 인증 중 하나를 거친다. 로그인을 시도하면 사용자에게 할당된 DN을 인증하는 요청이 전송된다. DN은 DSA를 시작하는 클라이언트 API 또는 서비를 통해 전송된다.

클라이언트는 자동으로 DSA에 바인딩되고 LDAP는 DN을 사용하여 LDAP 데이터베이스의 레코드에 일치하는 오브젝트 또는 오브젝트 집합을 검색한다. 이 단계에서 DN의 RDN이 매우 중요한데, 개인을 찾을 수 있도록 DIT를 통한 LDAP검색의 각 단계를 제공하기 때문이다. 경로에서 백엔드에 연결 RDN이 없으면 결과가 유효하지 않은 것으로 나타날 수 있다. 이 경우 LDAP가 검색하는 오브젝트는 개별 사용자 계정 이며 디렉토리의 계정에 일치하는 uid 및 userPassword가 있는 경우에만 사용자를 검증할 수 있다. 사용자 그룹은 LDAP 디렌토리 내의 오브젝트로도 식별된다.

사용자가 응답을 받으면 LDAP서버에서 클라이언트의 바인딩이 해제된다. 그러면 인증된 사용자가 시스템 관리자가 부여한 권한에 따라 필요한 파일, 사용자 정보 및 기타 애플리케이션 데이터를 포함하여 API 및 해당 서비스에 액세스할 수 있다.

![image-20241217143305584](../\Assets\image-20241217143305584.png)



## LDAP 디렉토리 구조

LDAP서버에는 여러 디렉토리 정보(entry)가 계층적 트리 구조 (hierarchical tree-like)로 구성되어 있다.

![image-20241217143828676](../Assets\image-20241217143828676.png)

- Entry 정보 창조는 RDN 이나 DN을 사용해서 정보를 얻어 올 수 있다.
- 가각의 엔트리는 다수의 속성을 갖는다.
- 각 속성은 이름, 값 + 형태
  - 이름 하나에 한개 이상의 값이 바인딩 될 수 있음.
- 각 엔트리는 DN이라는 고유한 값으로 지칭
  - 이 값으로 어디에 속한 엔트리인지 파악할 수 있다.



## 도구

LDAP 서버를 구축하기 위해 여러 옵션이 존재한다.

- Windows : 라이센스를 가지고 있다면 Acrive Directory가 적합
- 오픈소스 : OpenLDAP, Apache DS, OpenDJ, 389 Directory Server 등..
- MAC의 디렉토리 유틸리티
  - 임의의 LDAP 서버에 붙어서 내용을 간편하게 확인할 수 있음.
- Apcache Directory Studio
  - 이클립스 UI



## LDAP와 Active Directory

- LDAP는 네트워크의 모든 사용자 계정을 포괄하는 정보가 포함된 대규모 디렉토리 서비스 데이터베이스인 Microsoft Active Directory(AD) 디렉토리 서비스 등에서 사용되는 핵심 프로토콜이다.
- LDAP는 DAP(Directory Access Protocol) 의 경량 버전으로 TCP/IP(Transmission Control Protocol / Internet Protocol)에서 실행되는 디렉터리 서비스에 액세스하고 이를 관리하는 중앙 위치를 제공한다.
- AD는 사용자와 그룹에 대한 인증 및 관리를 제공하므로 결국 사용자 또는 컴퓨터를 인증하게 된다.
- 데이터베이스에서는 LDAP로 가져온 것 보다 더 많은 볼륨의 속성이 포함되어 있다.
- 그러나 LDAP는 정보가 거의 없는 디렉토리 오브젝트를 찾는 데 특화되어 있으므로 AD 또는 가져오는 디렉토리 서비스에서 모든 속성을 추출할 필요가 없다.
- LDAP의 주요 목표는 AD에서 오브젝트(도메인, 사용자, 그룹 등)와 통신하고 오브젝트를 저장하여 이를 LDAP 서버에 있는 자체 디렉토리에 사용할 수 있는 형식으로 추출한다.
- AD는 전 세계 최대 도서관이고, LDAP는 요청에 맞는 옵션을 모두 찾을 수 있는 위치를 정확히 알고 원하는 것을 찾았는지 확인해주는 숙련된 사서에 해당된다.
