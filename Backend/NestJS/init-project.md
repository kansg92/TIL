# nestJS



##  ì‚¬ìš©ì´ìœ 

- ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ë°±ì•¤ë“œë¥¼ ê·¸ëƒ¥ nodeJSë¡œ êµ¬ì„±í•´ë³´ê³  ì‹¶ì—ˆìŒ.
- ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” express ì™€ nestJSë¥¼ ë¹„êµí•˜ê³  ê³ ë¯¼ í–ˆì—ˆìŒ
- nestJSê°€ expressì— ë¹„í•´ typescriptì™€ ë” ì¹œí™”ì ì´ë©° íƒ€ì…ì•ˆì •ì„±ì´ ì¢‹ì„ ê²ƒ ê°™ì•„ì„œ nestJSë¥¼ ì„ íƒí•´ì„œ ì‚¬ìš©í•¨.



### ë°±ì•¤ë“œ nodeJS ë¹„êµ

#### Express.js 

- **ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” ê²½ëŸ‰ ì›¹ í”„ë ˆì„ì›Œí¬**
- ë¹ ë¥´ê²Œ REST API, ì„œë²„ êµ¬ì¶• ê°€ëŠ¥
- ë¯¸ë“¤ì›¨ì–´ ì¤‘ì‹¬ êµ¬ì¡°

âœ… **ì¥ì **

- ëŸ¬ë‹ì»¤ë¸Œ ë‚®ìŒ (ë¹ ë¥¸ ì‹œì‘ ê°€ëŠ¥)
- ëŒ€ê·œëª¨ ìƒíƒœê³„ & ìë£Œ í’ë¶€
- ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ìœ ì—°í•˜ê²Œ ì¡°í•© ê°€ëŠ¥

âŒ **ë‹¨ì **

- êµ¬ì¡°í™”ê°€ ë¶€ì¡±í•´ì„œ ê·œëª¨ê°€ ì»¤ì§€ë©´ ì½”ë“œ ë³µì¡ë„ â†‘
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì§€ì›ì€ ìˆì§€ë§Œ ê¸°ë³¸ì 

ğŸ”§ **ì¶”ì²œ ìƒí™©**

> ì†Œê·œëª¨ í”„ë¡œì íŠ¸, ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘, REST API ì„œë²„

#### nestJS

- Express(ë˜ëŠ” Fastify) ìœ„ì—ì„œ ë™ì‘í•˜ëŠ” **TypeScript ê¸°ë°˜ì˜ í’€ìŠ¤íƒ í”„ë ˆì„ì›Œí¬**
- Angular ìŠ¤íƒ€ì¼ì˜ ëª¨ë“ˆ/ì˜ì¡´ì„± ì£¼ì… êµ¬ì¡°

âœ… **ì¥ì **

- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì— ì í•©
- ëª¨ë“ˆí™” / DI / ë°ì½”ë ˆì´í„° ê¸°ë°˜ ì•„í‚¤í…ì²˜
- í…ŒìŠ¤íŠ¸, ë¬¸ì„œí™” ë“± ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥ ë‚´ì¥

âŒ **ë‹¨ì **

- ëŸ¬ë‹ ì»¤ë¸Œê°€ ë‹¤ì†Œ ìˆìŒ
- ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ì—” ì˜¤ë²„í‚¬ì¼ ìˆ˜ë„

ğŸ”§ **ì¶”ì²œ ìƒí™©**

> ì¤‘ëŒ€í˜• ì„œë¹„ìŠ¤, íŒ€ í”„ë¡œì íŠ¸, ìœ ì§€ë³´ìˆ˜ ê³ ë ¤í•œ êµ¬ì¡°ì  ê°œë°œ

#### Fastify

- Expressë³´ë‹¤ ë” ë¹ ë¥´ê³  í˜„ëŒ€ì ì¸ Node.js ì›¹ í”„ë ˆì„ì›Œí¬

âœ… **ì¥ì **

- ì„±ëŠ¥ ì¢‹ê³  ê²½ëŸ‰
- JSON Schema ê¸°ë°˜ì˜ ìš”ì²­/ì‘ë‹µ ê²€ì¦
- ê³µì‹ NestJSì™€ë„ ì—°ë™ ê°€ëŠ¥

âŒ **ë‹¨ì **

- ìµìˆ™í•˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼ì¼ ìˆ˜ ìˆìŒ
- ìƒíƒœê³„ëŠ” Expressë³´ë‹¨ ì‘ìŒ

ğŸ”§ **ì¶”ì²œ ìƒí™©**

> ê³ ì„±ëŠ¥ì´ í•„ìš”í•œ REST API ì„œë²„

## nestJS ì´ˆê¸° êµ¬í˜„ ë° ì…‹íŒ…



1. NestJS CLI ì„¤ì¹˜

`npm i -g @nestjs/cli`

2. í”„ë¡œì íŠ¸ ìƒì„±

`nest new my-backend-api`

3. ê¸°ë³¸ í´ë” êµ¬ì¡° (MVCíŒ¨í„´ì„ ë”°ë¥´ëŠ”ë“¯...?)

```````yaml
src/
â”œâ”€â”€ app.module.ts       â† ì•± ë£¨íŠ¸ ëª¨ë“ˆ
â”œâ”€â”€ main.ts             â† ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸
â”œâ”€â”€ users/              â† ì˜ˆì‹œ: ì‚¬ìš©ì ë„ë©”ì¸
â”‚   â”œâ”€â”€ users.controller.ts   â† C: Controller (Route handler)
â”‚   â”œâ”€â”€ users.service.ts      â† V: Service (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚   â”œâ”€â”€ users.module.ts       â† ëª¨ë“ˆ (ì˜ì¡´ì„± ê´€ë¦¬)
â”‚   â””â”€â”€ entities/
â”‚       â””â”€â”€ user.entity.ts    â† M: Model (DB Entity)
```````

4. ì„œë²„ ì‹¤í–‰(devëŠ” ë¹¼ë„ë¨)

`npm run start:dev`

ë¹Œë“œ : `npm run build`

í”„ë¡œë•íŠ¸ ì‹¤í–‰ : `npm run start:prod`

ê¸°ë³¸ ìŠ¤í¬ë¦¼íŠ¸ë“¤...

```````json
  "scripts": {
    "build": "nest build",
    "format": "prettier --write \"src/**/*.ts\" \"test/**/*.ts\"",
    "start": "nest start",
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",
    "test:e2e": "jest --config ./test/jest-e2e.json"
  },
  
```````



í”„ë¡ íŠ¸ì•¤ë“œ(vue)ì™€ ì—°ê²°ì‹œ 304ë¥¼ ê²Œì†í•´ì„œ vueì—ì„œ ëºì–´ê°€ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŒ... vueì—ì„œ 2ì‹œê°„ë™ì•ˆ ë»˜ì§“ì„ í•´ë´¤ëŠ”ë° buildë¥¼ í•´ë³´ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ë‹ˆ ì„œë²„ì™€ ì—°ê²°ì´ ë˜ì—ˆìŒ... axiosë¬¸ì œì¸ì§€.. vue proxyë¬¸ì œì¸ì§€ ì •í™•íˆ ëª¨ë¥´ê² ì§€ë§Œ buildë¥¼ í•´ë³´ëŠ” ìŠµê´€ì„ ê°–ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ìŒ



## NestJS DB connection

1. íŒ¨í‚¤ì§€ì„¤ì¹˜

`npm install --save @nestjs/typeorm typeorm mysql2`

`mysql12`ëŠ” MYSQL ë“œë¼ì´ë²„ ì—­í• 

2. .env íŒŒì¼ ì„¤ì •

   ```
   MYSQL_DATABASE_HOST = ''
   MYSQL_DATABASE_DB = ''
   MYSQL_DATABASE_USER = ''
   MYSQL_DATABASE_PASSWORD = ''
   MYSQL_DATABASE_CHARSET = ''
   ```

3. `app.module.ts` 

```typescript
import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { UsersModule } from './users/users.module';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { TypeOrmModule } from '@nestjs/typeorm';

@Module({
  imports: [
    UsersModule,
    ConfigModule.forRoot({ 
      envFilePath: `.env_${process.env.NODE_ENV ?? 'debug'}`, // NODE_ENVì— ë”°ë¼ envíŒŒì¼ ì‚¬ìš©
      isGlobal: true, // ì „ì—­ ì‚¬ìš©
    }),
    TypeOrmModule.forRootAsync({ // DB connection
      inject: [ConfigService],
      useFactory: (config: ConfigService) => ({
        type: 'mysql',
        host: config.get('MYSQL_DATABASE_HOST'),
        username: config.get('MYSQL_DATABASE_USER'),
        password: config.get('MYSQL_DATABASE_PASSWORD'),
        database: config.get('MYSQL_DATABASE_DB'),
        charset: config.get('MYSQL_DATABASE_CHARSET'),
        synchronize: false,
        autoLoadEntities: true,
        logging: true,
      }),
    }),
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```



4. `service.ts`

```typescript
import { Injectable } from '@nestjs/common';
import { UserDto } from './createUser.dto';
import { DataSource } from 'typeorm';

@Injectable()
export class UsersService {
  // dbconn..
  constructor(private readonly dataSource: DataSource) {}   

  // ë¹„ë™ê¸° promiseíƒ€ì…ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼í•¨...
  async findAllQuery(): Promise<UserDto[]> {
    const items = await this.dataSource.query<UserDto[]>(
      'SELECT * FROM users',
    );
    return items;
  }
    
}

```



### async/await íŒ¨í„´ì„ ì“°ëŠ” ì´ìœ 

1. ê°€ì¥ ì§ê´€ì ì´ê³  ê¹”ë”í•œ ì½”ë“œì„.
2. asyncëŠ” promiseë¥¼ ë°˜í™˜í•˜ê³  awaitëŠ” ì‘ë‹´ì´ ë ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ(ë¹„ë™ê¸°)
3. awaitë¥¼ ì•ˆì“°ê²Œ ëœë‹¤ë©´ promise<pending> ìœ¼ë¡œ ì‘ë‹´ê²°ê³¼ê°€ ë‚˜ì™€ì„œ ë¹„ë™ê¸°ë¥¼ ì¨ì•¼í•¨
4. Nestì˜ ì˜ˆì™¸ ì²˜ë¦¬ / ì‘ë‹µ ì²˜ë¦¬ì™€ ìì—°ìŠ¤ëŸ½ê²Œ ë™ì‘í•¨
5. ìœ ì§€ë³´ìˆ˜/í˜‘ì—…ì— ê°•í•¨

